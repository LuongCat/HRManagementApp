<UserControl x:Class="HRManagementApp.UI.Views.ScanAttendanceView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200"
             Unloaded="UserControl_Unloaded"> <!-- Quan trọng: Sự kiện hủy Camera khi tắt -->

    <Grid Background="#111827"> <!-- Nền tối hiện đại -->
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/> <!-- Camera Area -->
            <ColumnDefinition Width="1*"/> <!-- Info Area -->
        </Grid.ColumnDefinitions>

        <!-- 1. CAMERA AREA -->
        <Border Grid.Column="0" Background="Black" CornerRadius="0" ClipToBounds="True">
            <Grid>
                <!-- Hình ảnh Camera -->
                <Image x:Name="CameraImage" Stretch="UniformToFill"/>

                <!-- Lớp phủ tối mờ -->
                <Border Background="#000000" Opacity="0.3"/>

                <!-- Khung quét (Scan Zone) -->
                <Border Width="300" Height="300" 
                        BorderBrush="#00FF00" BorderThickness="2" 
                        CornerRadius="20"
                        HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Border.Effect>
                        <DropShadowEffect Color="#00FF00" BlurRadius="20" ShadowDepth="0"/>
                    </Border.Effect>
                    
                    <!-- Hiệu ứng đường quét chạy chạy -->
                    <Grid ClipToBounds="True">
                        <Border Height="2" Background="#00FF00" VerticalAlignment="Top" Opacity="0.8">
                            <Border.Effect>
                                <DropShadowEffect Color="#00FF00" BlurRadius="10"/>
                            </Border.Effect>
                            <Border.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard>
                                        <Storyboard RepeatBehavior="Forever">
                                            <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                             From="0" To="300" Duration="0:0:2" AutoReverse="False"/>
                                            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                             From="1" To="0" Duration="0:0:2"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </Border.Triggers>
                            <Border.RenderTransform>
                                <TranslateTransform/>
                            </Border.RenderTransform>
                        </Border>
                    </Grid>
                </Border>

                <TextBlock Text="Đưa mã nhân viên vào khung hình" 
                           Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Bottom" 
                           Margin="0,0,0,50" FontSize="16" FontWeight="SemiBold" Opacity="0.8"/>
            </Grid>
        </Border>

        <!-- 2. INFO & MANUAL INPUT AREA -->
        <Border Grid.Column="1" Background="White" Padding="30">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Title -->
                <StackPanel Grid.Row="0" Margin="0,0,0,30">
                    <TextBlock Text="Máy Chấm Công" FontSize="24" FontWeight="Bold" Foreground="#1F2937"/>
                    <TextBlock Text="AI Facial &amp; Barcode Scanner" FontSize="14" Foreground="#6B7280"/>
                </StackPanel>

                <!-- Manual Input -->
                <StackPanel Grid.Row="1" Margin="0,0,0,30">
                    <TextBlock Text="Nhập mã thủ công" FontWeight="SemiBold" Foreground="#374151" Margin="0,0,0,8"/>
                    <Grid>
                        <TextBox x:Name="txtManualCode" 
                                 Height="50" FontSize="18" FontWeight="Bold" VerticalContentAlignment="Center" Padding="10,0"
                                 BorderBrush="#E5E7EB" BorderThickness="2"
                                 KeyDown="TxtManualCode_KeyDown">
                            <TextBox.Resources>
                                <Style TargetType="Border">
                                    <Setter Property="CornerRadius" Value="8"/>
                                </Style>
                            </TextBox.Resources>
                        </TextBox>
                        <Button Content="Enter" HorizontalAlignment="Right" Margin="5" Padding="15,0"
                                Background="#1F2937" Foreground="White" BorderThickness="0"
                                Click="BtnManualEnter_Click" Cursor="Hand">
                             <Button.Resources>
                                <Style TargetType="Border">
                                    <Setter Property="CornerRadius" Value="6"/>
                                </Style>
                            </Button.Resources>
                        </Button>
                    </Grid>
                    <TextBlock Text="Nhập mã và nhấn Enter hoặc nút bên cạnh" FontSize="12" Foreground="#9CA3AF" Margin="0,5,0,0"/>
                </StackPanel>

                <!-- Result Status Display -->
                <Border Grid.Row="2" x:Name="pnlStatus" Background="#F3F4F6" CornerRadius="12" Padding="20" VerticalAlignment="Top" Visibility="Collapsed">
                    <StackPanel HorizontalAlignment="Center">
                        <!-- Icon -->
                        <TextBlock x:Name="txtStatusIcon" Text="✅" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                        
                        <!-- Tên NV -->
                        <TextBlock x:Name="txtEmployeeName" Text="Nguyễn Văn A" FontSize="20" FontWeight="Bold" Foreground="#111827" HorizontalAlignment="Center"/>
                        <TextBlock x:Name="txtEmployeeID" Text="MNV: 1023" FontSize="14" Foreground="#6B7280" HorizontalAlignment="Center" Margin="0,0,0,15"/>
                        
                        <!-- Loại chấm công -->
                        <Border x:Name="borderType" Background="#DCFCE7" CornerRadius="20" Padding="15,5" HorizontalAlignment="Center" Margin="0,0,0,10">
                            <TextBlock x:Name="txtAttendanceType" Text="CHECK IN" FontWeight="Bold" Foreground="#166534"/>
                        </Border>
                        
                        <!-- Giờ -->
                        <TextBlock x:Name="txtTime" Text="08:00:15" FontSize="32" FontWeight="Bold" Foreground="#1F2937" HorizontalAlignment="Center"/>
                        
                        <!-- Thông báo -->
                        <TextBlock x:Name="txtMessage" Text="Chấm công thành công" FontSize="14" Foreground="#059669" HorizontalAlignment="Center" Margin="0,10,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Footer -->
                <StackPanel Grid.Row="3">
                     <TextBlock Text="Hệ thống đang hoạt động" Foreground="#10B981" FontWeight="SemiBold" HorizontalAlignment="Center">
                         <Run Text="●" Foreground="#10B981"/> 
                         <Run Text=" Camera Active"/>
                     </TextBlock>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>